<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
<div id="app">
    <v-app dark>
        <v-content>
            <v-container grid-list-md >
                <v-layout row wrap >
                    <v-flex xs10 offset-xs1 text-xs-center>
                        <h1>Joseph Anderson's Halloween Voting </h1>
                        A <a href="https://github.com/Nodja/Nodja.github.io/blob/master/joevotes/joevotecount.py">python script</a> on my home computer updates this data every 5 minutes. <br>
                        To vote you need to have joined discord before the voting started (you'll have the halloween voter role) and go on the #halloween-voting-event
                        channel on <a href="https://discordapp.com/invite/8gSBsYC">the discord server</a>.
                        <br><br>

                        Last updated: {{ last_update }} EST <br>
                        Votes compared with votes from: {{ compare_date }} <br><br>
                        {{ total_voters }} people have voted. <br>
                        {{ nontop_voters }} people have not voted in the top 10. <br><br>
                        {{ specials['god damn weebs'] }} poeple are tired of all this weeb shit (god damn weebs votes) <br>
                        {{ specials['LEON'] }} out of 11037 people like to drive memes to the ground (LEON votes) <br>
                        Your momma so fat {{ specials['Your Mom'] }} people ran out of gas trying to go around her (Your Mom votes)
                    </v-flex>
                    <v-layout>
                        <table>
                            <tr v-for="(vote, index) in votes">
                                <td style="min-width: 250px">
                                    {{ vote[0] }}
                                </td>
                                <td style="min-width: 80px">
                                    {{ vote[1] }} 
                                    (
                                    <span style="color: green" v-if="vote[2].startsWith('+')" >{{ vote[2] }}</span>
                                    <span style="color: red" v-else-if="vote[2].startsWith('-')" >{{ vote[2] }}</span>
                                    <span v-else >{{ vote[2] }}</span>
                                    )
                                </td>
                                <td style="min-width:100px; width: 100%">
                                    <v-progress-linear v-model="vote[3]" height="20" style="margin: 0px; overflow: visible;"></v-progress-linear>
                                </td>
                            </tr>
                        </table>
                    </v-layout>
                </v-layout>
            </v-container>
        </v-content>
    </v-app>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>

<script>
    function comparator(a, b) {
        if (a[1] < b[1]) return 1;
        if (a[1] > b[1]) return -1;
        return 0;
    }

    new Vue({
        el: '#app',
        methods: {
            loadVotes: function () {
                axios.get('votes.json')
                    .then(response => {
                        this.votes = response.data['votes'];
                        this.last_update = response.data['last_update'];
                        this.total_voters = response.data['total_voters'];
                        this.nontop_voters = response.data['nontop_voters'];
                        this.compare_date = response.data['compare_date'];
                        this.votes.sort(comparator);
                        this.specials = response.data['specials'];
                        var votes_max = Math.floor(this.votes[0][1]);
                        for (var vote of this.votes) {
                            var percentage = vote[1] / votes_max * 100;
                            vote.push(percentage);
                        }

                    })
            }
        },
        mounted() {
            this.loadVotes();
            setInterval(function () {
                this.loadVotes();
            }.bind(this), 60000);
        },
        data: {
            votes: [],
            last_update: null,
            compare_date: null,
            total_voters: 0,
            nontop_voters: 0,
            specials: {}
        },
    })
</script>
</body>
</html>